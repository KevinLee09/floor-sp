# More detailed information for Floor-SP


## Corner/edgeness modules for energy terms

1. We provide the pre-trained weights for the corner/edgeness module (a DRN-based neural network) and the corner-room association module. Please visit this [link](https://drive.google.com/open?id=1Rb37cQd4gey2gYWvKL94VYBuRPFqJRVX) to download them.

2. `./configs/config_cornernet.yaml` is the setup for the training/inference of the corner/edgeness module. And `./configs/config_associate_module.yaml` is for the training/inference of the association module. Please do set up the `model_path` properly to make it consistent with the path where you save our pre-trained weights.

3. The dataset `Lianjia_corner` and `Lianjia_room` are for corner/edgeness and room-corner association, respectively. They are generated by the Mask-RCNN part as discussed in the [main page](https://github.com/woodfrog/Lianjia-inverse-cad).

4. Run the inference of the corner/edgeness module by the following command after set up the options properly in the config file `./configs/config_cornernet.yaml`. 

    ```bash
    python ./mains/corner_main.py
    ```

5. After running the corner/edgeness module, run the inference of the room-corner association module by the following command after set up the options properly in `./configs/config_associate_module.yaml`. This will produce the set of corners for every room, and we use these corners to determine the room bounding box and generate necessary information for the energy terms defined in the *room-aware floorplan reconstruction* (see the paper for details).  

    ```bash
    python ./mains/associate_main.py
    ```

## Room-wise coordinate descent + room merging

1. `./mains/extract_floorplan.py` runs the *room-wise coordinate descent*, the sequential room-wise shortest path algorithm, to solve for the optimal room polygonal loops. The room structures are then merged into a final floorplan.

